<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kubulete Restart on Longhorn Manual Test Cases</title>
    <link>https://longhorn.github.io/longhorn-tests/manual/pre-release/node-not-ready/kubelet-restart/</link>
    <description>Recent content in Kubulete Restart on Longhorn Manual Test Cases</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <atom:link href="https://longhorn.github.io/longhorn-tests/manual/pre-release/node-not-ready/kubelet-restart/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Test kubelet restart on a node of the cluster</title>
      <link>https://longhorn.github.io/longhorn-tests/manual/pre-release/node-not-ready/kubelet-restart/kubelet-restart-on-a-node/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>https://longhorn.github.io/longhorn-tests/manual/pre-release/node-not-ready/kubelet-restart/kubelet-restart-on-a-node/</guid>
      <description>&lt;h3 id=&#34;related-issues&#34;&gt;Related issues:&lt;/h3&gt;&#xA;&lt;p&gt;&lt;a href=&#34;https://github.com/longhorn/longhorn/issues/2629&#34;&gt;https://github.com/longhorn/longhorn/issues/2629&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h3 id=&#34;case-1-kubelet-restart-on-rke1-multi-node-cluster&#34;&gt;Case 1: Kubelet restart on RKE1 multi node cluster:&lt;/h3&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Create a RKE1 cluster with config of 1 etcd/control plane and 3 worker nodes.&lt;/li&gt;&#xA;&lt;li&gt;Deploy Longhorn on the cluster.&lt;/li&gt;&#xA;&lt;li&gt;Deploy prometheus monitoring app on the cluster which is using Longhorn storage class or deploy a statefulSet with Longhorn volume.&lt;/li&gt;&#xA;&lt;li&gt;Write some data into the mount point and compute the md5sum.&lt;/li&gt;&#xA;&lt;li&gt;Restart the kubelet on the node where the statefulSet or Prometheus pod is running using the command &lt;code&gt;sudo docker restart kubelet&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Observe the volume. It becomes degraded but is still running.&lt;/li&gt;&#xA;&lt;li&gt;Once the node is back, the volume of the workload should work fine and the data is intact.&lt;/li&gt;&#xA;&lt;li&gt;Scale down then re-scale up the workload. Verify the existing data is correct.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 id=&#34;case-2-kubelet-restart-on-one-node-rke1-cluster&#34;&gt;Case 2: Kubelet restart on one node RKE1 cluster:&lt;/h3&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Create a RKE1 cluster with config of 1 node all role.&lt;/li&gt;&#xA;&lt;li&gt;Deploy Longhorn on the cluster.&lt;/li&gt;&#xA;&lt;li&gt;Deploy prometheus monitoring app on the cluster which is using Longhorn storage class or deploy a statefulSet with Longhorn volume.&lt;/li&gt;&#xA;&lt;li&gt;Write some data into the mount point and compute the md5sum.&lt;/li&gt;&#xA;&lt;li&gt;Restart the kubelet on the node using the command &lt;code&gt;sudo docker restart kubelet&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Check the instance manager pods on the node are still running.&lt;/li&gt;&#xA;&lt;li&gt;Observe the volume. It gets detached and the pod gets terminated (since the only replica of the volume becomes failed).&lt;/li&gt;&#xA;&lt;li&gt;Once the pod is terminated, a new pod should be created and get attached to the volume successfully.&lt;/li&gt;&#xA;&lt;li&gt;Verify that the mount of the volume is successful and data is safe.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 id=&#34;case-3-rke2-serverrke2-agent-restart-on-rke2-multi-node-cluster&#34;&gt;Case 3: rke2-server/rke2-agent restart on RKE2 multi node cluster:&lt;/h3&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Create a RKE2 cluster with config of 1 control plane and 3 worker nodes.&lt;/li&gt;&#xA;&lt;li&gt;Deploy Longhorn on the cluster.&lt;/li&gt;&#xA;&lt;li&gt;Deploy prometheus monitoring app on the cluster which is using Longhorn storage class or deploy a statefulSet with Longhorn volume.&lt;/li&gt;&#xA;&lt;li&gt;Write some data into the mount point and compute the md5sum.&lt;/li&gt;&#xA;&lt;li&gt;Restart the rke-agent service on the node where the statefulSet or Prometheus pod is running using the command &lt;code&gt;systemctl restart rke2-agent.service&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Observe the volume. It becomes degraded but is still running.&lt;/li&gt;&#xA;&lt;li&gt;Once the node is back, the volume of the workload should work fine and the data is intact.&lt;/li&gt;&#xA;&lt;li&gt;Scale down then re-scale up the workload. Verify the existing data is correct.&lt;/li&gt;&#xA;&lt;li&gt;Create a StatefulSet with Longhorn volume on the control plane node.&lt;/li&gt;&#xA;&lt;li&gt;Once the StatefulSet is up and running, Write some data into the mount point and compute the md5sum.&lt;/li&gt;&#xA;&lt;li&gt;Restart the rke2-service on the control plane node using the command &lt;code&gt;systemctl restart rke2-server.service&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;Observe the volume. It becomes degraded but is still running.&lt;/li&gt;&#xA;&lt;li&gt;Once the node is back, the volume of the workload should work fine and the data is intact.&lt;/li&gt;&#xA;&lt;li&gt;Scale down then re-scale up the workload. Verify the existing data is correct.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 id=&#34;case-4-kubelet-restart-on-a-node-with-rwx-volume-on-a-rke1-cluster&#34;&gt;Case 4: Kubelet restart on a node with RWX volume on a RKE1 Cluster:&lt;/h3&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Create a RKE1 cluster with config of 1 etcd/control plane and 3 worker nodes.&lt;/li&gt;&#xA;&lt;li&gt;Deploy Longhorn on the cluster.&lt;/li&gt;&#xA;&lt;li&gt;Deploy a statefulSet attached with an RWX volume.&lt;/li&gt;&#xA;&lt;li&gt;Write some data into the mount point and compute the md5sum.&lt;/li&gt;&#xA;&lt;li&gt;Restart the kubelet on the node where the share-manager pod is running using the command &lt;code&gt;sudo docker restart kubelet&lt;/code&gt;&lt;/li&gt;&#xA;&lt;li&gt;Observe the volume. It gets detached and the share-manager pod gets terminated.&lt;/li&gt;&#xA;&lt;li&gt;Watch the pod of the StatefulSet using the command &lt;code&gt;kubectl get pods -n &amp;lt;namespace&amp;gt; -w&lt;/code&gt;.&lt;/li&gt;&#xA;&lt;li&gt;The pods (share manager and StatefulSet, instance manager pods are not included) should be terminated and restarted.&lt;/li&gt;&#xA;&lt;li&gt;Verify that the mount of the volume is successful and data is safe.&lt;/li&gt;&#xA;&lt;li&gt;Repeat the above steps where the StatefulSet pod and share-manager pod are attached to different nodes and restart the node where the statefulSet pod is running.&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h3 id=&#34;case-5-kubelet-restart-on-a-node-with-rwx-volume-on-a-rke2-cluster&#34;&gt;Case 5: Kubelet restart on a node with RWX volume on a RKE2 Cluster:&lt;/h3&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;Repeat the steps from the case 4 on an RKE2 cluster.&lt;/li&gt;&#xA;&lt;/ol&gt;</description>
    </item>
  </channel>
</rss>
